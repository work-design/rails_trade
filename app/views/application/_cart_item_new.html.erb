<% if item.persisted? %>
  <div id="cart_item_new_<%= item.cart_identity %>" data-controller="modify" data-modify-submit-value="true" data-modify-step-value="1" class="inline-flex align-items-center" style="width: fit-content">
    <div class="mr-3 text-danger"><%= item.amount.to_money.format.html_safe %></div>
    <% if item.number <= 1 %>
      <%= form_with theme: nil, model: item, scope: '', url: { controller: item_con, action: 'destroy', id: item.id }, method: :delete, class: 'button_to mr-1' do |f| %>
        <%= f.hidden_field :current_cart_id, value: cart.id %>
        <%= f.hidden_field 'replace[][partial]', value: 'cart_item_new' %>
        <%= f.hidden_field 'replace[][partial]', value: 'cart_item_add' %>
        <% renew.each do |id, partial| %>
          <%= hidden_field_tag "renew[#{id}]", partial, id: nil %>
        <% end if defined?(renew) && renew %>
        <% options.each do |key, value| %>
          <%= hidden_field_tag "options[#{key}]", value, id: nil %>
        <% end if defined?(options) && options %>
        <%= button_tag do %>
          <%= svg_tag 'circle-xmark', class: 'icon text-grey' %>
        <% end %>
      <% end %>
    <% else %>
      <%= button_tag(data: { action: 'modify#minus' }, class: 'button_to mr-1') do %>
        <%= svg_tag 'circle-minus', class: 'icon text-grey' %>
      <% end %>
    <% end %>
    <%= form_with theme: nil, model: item, scope: '', url: { controller: item_con, action: 'update', id: item.id }, method: :patch, data: { controller: 'input' } do |f| %>
      <%= f.hidden_field :current_cart_id, value: cart.id %>
      <%= f.hidden_field :dispatch %>
      <%= f.number_field :number, value: item.number.to_human, step: 0.01, data: { action: 'change->input#form focus->input#blank', modify_target: 'input' }, class: 'background-light text-centered', style: 'width: 30px' %>
      <%= hidden_field_tag 'replace[][partial]', 'cart_item_new' %>
      <% renew.each do |id, partial| %>
        <%= hidden_field_tag "renew[#{id}]", partial, id: nil %>
      <% end if defined?(renew) && renew %>
      <% options.each do |key, value| %>
        <%= hidden_field_tag "options[#{key}]", value, id: nil %>
      <% end if defined?(options) && options %>
    <% end %>
    <button data-action="modify#plus" class="button_to ml-1">
      <%= svg_tag 'circle-plus', class: 'icon text-grey' %>
    </button>
  </div>
<% else %>
  <%= form_with theme: nil, model: item, scope: '', url: { controller: item_con, action: 'create' }, id: "cart_item_new_#{item.cart_identity}", class: 'button_to' do |f| %>
    <%= f.hidden_field :current_cart_id, value: cart.id %>
    <%= f.hidden_field :good_type %>
    <%= f.hidden_field :good_id %>
    <%= f.hidden_field :dispatch %>
    <%= f.hidden_field :produce_on %>
    <%= f.hidden_field :scene_id %>
    <%= f.hidden_field :station_id %>
    <%= f.hidden_field :desk_id %>
    <% renew.each do |id, partial| %>
      <%= hidden_field_tag "renew[#{id}]", partial, id: nil %>
    <% end if defined?(renew) && renew %>
    <% options.each do |key, value| %>
      <%= hidden_field_tag "options[#{key}]", value, id: nil %>
    <% end if defined?(options) && options %>
    <button type="submit" name="replace[][partial]" value="cart_item_new" class="button is-small is-warning is-rounded">
      <%= svg_tag 'cart-plus' %>
      <span class="ml-1">加入购物车</span>
    </button>
  <% end %>
<% end %>
