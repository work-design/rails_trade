<% if request.variant.any?(:mini_program) %>
  <div
    data-controller="mini-program"
    data-mini-program-direct-value="true"
    data-mini-program-url-value="/pages/wxpay_pay/index"
    data-mini-program-data-value="<%=
      {
        url: url_for(controller: 'payments', action: 'wxpay', order_id: @order.id, only_path: false),
        path: url_for(only_path: false),
        path_fail: url_for(only_path: false)
      }.to_json
    %>"
    class="media"
  ></div>
<% elsif @wxpay_order && @wxpay_order[:package].present? %>
  <div
    data-controller="wxpay"
    data-wxpay-options-value="<%= payment_order.payment.payee_app.app.js_config(session[:enter_url]).to_json %>"
    data-wxpay-params-value="<%= @wxpay_order.slice(:timeStamp, :nonceStr, :package, :signType, :paySign, :appId).to_json %>"
    data-action="click->wxpay#onBridgeReady"
    class="media"
  >
    <div class="media-left"><%= image_tag 'icons/wxpay.svg', class: 'image is-24x24' %></div>
    <div class="media-content text-primary">微信支付</div>
    <div class="media-right text-danger"><%= payment_order.order_amount.to_money.format.html_safe %></div>
  </div>
<% end %>
